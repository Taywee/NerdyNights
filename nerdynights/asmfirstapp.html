<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. 6502 ASM, first app &#8212; Nerdy Nights 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Color Palettes, Sprites, second app" href="colorpalettes.html" />
    <link rel="prev" title="2. NES Architecture Overview" href="nesarchitecture.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="colorpalettes.html" title="4. Color Palettes, Sprites, second app"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="nesarchitecture.html" title="2. NES Architecture Overview"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Nerdy Nights 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../nerdynights.html" accesskey="U">Nerdy Nights</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="asm-first-app">
<h1>3. 6502 ASM, first app<a class="headerlink" href="#asm-first-app" title="Permalink to this headline">¶</a></h1>
<div class="admonition-this-week admonition">
<p class="first admonition-title">This Week</p>
<p class="last">Starts getting into more details about the 6502 and intro to assembly
language. The lessons for asm usage and NES specifics will be done in
sections together. There are many other 6502 <a class="reference external" href="http://www.obelisk.demon.co.uk/6502/">websites</a> and good books which may help you
learn better.</p>
</div>
<dl class="docutils">
<dt>Bit</dt>
<dd>The smallest unit in computers. It is either a 1 (on) or a 0 (off), like a
light switch.</dd>
<dt>Byte</dt>
<dd>8 bits together form one byte, a number from 0 to 255. Two bytes put
together is 16 bits, forming a number from 0 to 65535. Bits in the byte are
numbered starting from the right at 0.</dd>
<dt>Instruction</dt>
<dd>one command a processor executes. Instructions are run sequentially.</dd>
</dl>
<div class="section" id="code-layout">
<h2>3.1. Code Layout<a class="headerlink" href="#code-layout" title="Permalink to this headline">¶</a></h2>
<p>In assembly language there are 5 main parts. Some parts must be in a specific
horizontal position for the assembler to use them correctly.</p>
<div class="section" id="directives">
<h3>3.1.1. Directives<a class="headerlink" href="#directives" title="Permalink to this headline">¶</a></h3>
<p>Directives are commands you send to the assembler to do things like locating
code in memory. They start with a . and are indented. Some people use tabs, or
4 spaces, and I use 2 spaces. This sample directive tells the assembler to put
the code starting at memory location $8000, which is inside the game ROM area:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="kp">.org</span> <span class="mh">$8000</span>
</pre></div>
</div>
</div>
<div class="section" id="labels">
<h3>3.1.2. Labels<a class="headerlink" href="#labels" title="Permalink to this headline">¶</a></h3>
<p>The label is aligned to the far left and has a : at the end. The label is just
something you use to organize your code and make it easier to read. The
assembler translates the label into an address. Sample label:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span>  <span class="kp">.org</span> <span class="mh">$8000</span>
<span class="nl">MyFunction:</span>
</pre></div>
</div>
<p>When the assembler runs, it will do a find/replace to set MyFunction to
$8000. The if you have any code that uses MyFunction like:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="k">STA</span> <span class="n">MyFunction</span>
</pre></div>
</div>
<p>It will find/replace to:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="k">STA</span> <span class="mh">$8000</span>
</pre></div>
</div>
</div>
<div class="section" id="opcodes">
<h3>3.1.3. Opcodes<a class="headerlink" href="#opcodes" title="Permalink to this headline">¶</a></h3>
<p>The opcode is the instruction that the processor will run, and is indented like
the directives. In this sample, JMP is the opcode that tells the processor to
jump to the MyFunction label:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span>  <span class="kp">.org</span> <span class="mh">$8000</span>
<span class="nl">MyFunction:</span>
  <span class="k">JMP</span> <span class="n">MyFunction</span>
</pre></div>
</div>
</div>
<div class="section" id="operands">
<h3>3.1.4. Operands<a class="headerlink" href="#operands" title="Permalink to this headline">¶</a></h3>
<p>The operands are additional information for the opcode. Opcodes have between
one and three operands. In this example the #$FF is the operand:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span>  <span class="kp">.org</span> <span class="mh">$8000</span>
<span class="nl">MyFunction:</span>
  <span class="k">LDA</span> <span class="p">#</span><span class="mh">$FF</span>
  <span class="k">JMP</span> <span class="n">MyFunction</span>
</pre></div>
</div>
</div>
<div class="section" id="comments">
<h3>3.1.5. Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h3>
<p>Comments are to help you understand in English what the code is doing.  When
you write code and come back later, the comments will save you. You do not need
a comment on every line, but should have enough to explain what is happening.
Comments start with a ; and are completely ignored by the assembler. They can
be put anywhere horizontally, but are usually spaced beyond the long lines:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span>  <span class="kp">.org</span> <span class="mh">$8000</span>
<span class="nl">MyFunction:</span>        <span class="c1">; loads FF into accumulator</span>
  <span class="k">LDA</span> <span class="p">#</span><span class="mh">$FF</span>
  <span class="k">JMP</span> <span class="n">MyFunction</span>
</pre></div>
</div>
<p>This code would just continually run the loop, loading the hex value $FF into
the accumulator each time.</p>
</div>
</div>
<div class="section" id="processor-overview">
<h2>3.2. 6502 Processor Overview<a class="headerlink" href="#processor-overview" title="Permalink to this headline">¶</a></h2>
<p>The 6502 is an 8 bit processor with a 16 bit address bus. It can access 64KB of
memory without bank switching. In the NES this memory space is split up into
RAM, PPU/Audio/Controller access, and game ROM.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$0000-0800</td>
<td>Internal RAM, 2KB chip in the NES</td>
</tr>
<tr class="row-even"><td>$2000-2007</td>
<td>PPU access ports</td>
</tr>
<tr class="row-odd"><td>$4000-4017</td>
<td>Audio and controller access ports</td>
</tr>
<tr class="row-even"><td>$6000-7FFF</td>
<td>Optional WRAM inside the game cart</td>
</tr>
<tr class="row-odd"><td>$8000-FFFF</td>
<td>Game cart ROM</td>
</tr>
</tbody>
</table>
<p>Any of the game cart sections can be bank switched to get access to more
memory, but memory mappers will not be included in this tutorial.</p>
</div>
<div class="section" id="assembly-overview">
<h2>3.3. 6502 Assembly Overview<a class="headerlink" href="#assembly-overview" title="Permalink to this headline">¶</a></h2>
<p>The assembly language for 6502 starts with a 3 character code for the
instruction &#8220;opcode&#8221;. There are 56 instructions, 10 of which you will use
frequently. Many instructions will have a value after the opcode, which you can
write in decimal or hex. If that value starts with a # then it means use the
actual number. If the value doesn&#8217;t have then # then it means use the value at
that address. So LDA #$05 means load the value 5, LDA $0005 means load the
value that is stored at address $0005.</p>
</div>
<div class="section" id="registers">
<h2>3.4. 6502 Registers<a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h2>
<p>A register is a place inside the processor that holds a value. The 6502 has
three 8 bit registers and a status register that you will be using.  All your
data processing uses these registers. There are additional registers that are
not covered in this tutorial.</p>
<div class="section" id="accumulator">
<h3>3.4.1. Accumulator<a class="headerlink" href="#accumulator" title="Permalink to this headline">¶</a></h3>
<p>The Accumulator (A) is the main 8 bit register for loading, storing, comparing,
and doing math on data. Some of the most frequent operations are:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="k">LDA</span> <span class="p">#</span><span class="mh">$FF</span>  <span class="c1">;load the hex value $FF (decimal 256) into A</span>
<span class="k">STA</span> <span class="mh">$0000</span> <span class="c1">;store the accumulator into memory location $0000, internal RAM</span>
</pre></div>
</div>
</div>
<div class="section" id="index-register-x">
<h3>3.4.2. Index Register X<a class="headerlink" href="#index-register-x" title="Permalink to this headline">¶</a></h3>
<p>The Index Register X (X) is another 8 bit register, usually used for counting
or memory access. In loops you will use this register to keep track of how many
times the loop has gone, while using A to process data. Some frequent
operations are:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="k">LDX</span> <span class="mh">$0000</span> <span class="c1">;load the value at memory location $0000 into X</span>
<span class="k">INX</span>       <span class="c1">;increment X   X = X + 1</span>
</pre></div>
</div>
</div>
<div class="section" id="index-register-y">
<h3>3.4.3. Index Register Y<a class="headerlink" href="#index-register-y" title="Permalink to this headline">¶</a></h3>
<p>The Index Register Y (Y) works almost the same as X. Some instructions (not
covered here) only work with X and not Y. Some operations are:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="k">STY</span> <span class="mh">$00BA</span> <span class="c1">;store Y into memory location $00BA</span>
<span class="k">TYA</span>       <span class="c1">;transfer Y into Accumulator</span>
</pre></div>
</div>
</div>
<div class="section" id="status-register">
<h3>3.4.4. Status Register<a class="headerlink" href="#status-register" title="Permalink to this headline">¶</a></h3>
<p>The Status Register holds flags with information about the last
instruction. For example when doing a subtract you can check if the
result was a zero.</p>
</div>
</div>
<div class="section" id="instruction-set">
<h2>3.5. 6502 Instruction Set<a class="headerlink" href="#instruction-set" title="Permalink to this headline">¶</a></h2>
<p>These are just the most common and basic instructions. Most have a few
different options which will be used later. There are also a few more
complicated instructions to be covered later.</p>
<div class="section" id="common-load-store-opcodes">
<h3>3.5.1. Common Load/Store opcodes<a class="headerlink" href="#common-load-store-opcodes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="k">LDA</span> <span class="p">#</span><span class="mh">$0A</span>   <span class="c1">; LoaD the value 0A into the accumulator A</span>
           <span class="c1">; the number part of the opcode can be a value or an address</span>
           <span class="c1">; if the value is zero, the zero flag will be set.</span>

<span class="k">LDX</span> <span class="mh">$0000</span>  <span class="c1">; LoaD the value at address $0000 into the index register X</span>
           <span class="c1">; if the value is zero, the zero flag will be set.</span>

<span class="k">LDY</span> <span class="p">#</span><span class="mh">$FF</span>   <span class="c1">; LoaD the value $FF into the index register Y</span>
           <span class="c1">; if the value is zero, the zero flag will be set.</span>

<span class="k">STA</span> <span class="mh">$2000</span>  <span class="c1">; STore the value from accumulator A into the address $2000</span>
           <span class="c1">; the number part must be an address</span>

<span class="k">STX</span> <span class="mh">$4016</span>  <span class="c1">; STore value in X into $4016</span>
           <span class="c1">; the number part must be an address</span>

<span class="k">STY</span> <span class="mh">$0101</span>  <span class="c1">; STore Y into $0101</span>
           <span class="c1">; the number part must be an address</span>

<span class="k">TAX</span>        <span class="c1">; Transfer the value from A into X</span>
           <span class="c1">; if the value is zero, the zero flag will be set</span>

<span class="k">TAY</span>        <span class="c1">; Transfer A into Y</span>
           <span class="c1">; if the value is zero, the zero flag will be set</span>

<span class="k">TXA</span>        <span class="c1">; Transfer X into A</span>
           <span class="c1">; if the value is zero, the zero flag will be set</span>

<span class="k">TYA</span>        <span class="c1">; Transfer Y into A</span>
           <span class="c1">; if the value is zero, the zero flag will be set</span>
</pre></div>
</div>
</div>
<div class="section" id="common-math-opcodes">
<h3>3.5.2. Common Math opcodes<a class="headerlink" href="#common-math-opcodes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="k">ADC</span> <span class="p">#</span><span class="mh">$01</span>   <span class="c1">; ADd with Carry</span>
           <span class="c1">; A = A + $01 + carry</span>
           <span class="c1">; if the result is zero, the zero flag will be set</span>

<span class="k">SBC</span> <span class="p">#</span><span class="mh">$80</span>   <span class="c1">; SuBtract with Carry</span>
           <span class="c1">; A = A - $80 - (1 - carry)</span>
           <span class="c1">; if the result is zero, the zero flag will be set</span>

<span class="k">CLC</span>        <span class="c1">; CLear Carry flag in status register</span>
           <span class="c1">; usually this should be done before ADC</span>

<span class="k">SEC</span>        <span class="c1">; SEt Carry flag in status register</span>
           <span class="c1">; usually this should be done before SBC</span>

<span class="k">INC</span> <span class="mh">$0100</span>  <span class="c1">; INCrement value at address $0100</span>
           <span class="c1">; if the result is zero, the zero flag will be set</span>

<span class="k">DEC</span> <span class="mh">$0001</span>  <span class="c1">; DECrement $0001</span>
           <span class="c1">; if the result is zero, the zero flag will be set</span>

<span class="k">INY</span>        <span class="c1">; INcrement Y register</span>
           <span class="c1">; if the result is zero, the zero flag will be set</span>

<span class="k">INX</span>        <span class="c1">; INcrement X register</span>
           <span class="c1">; if the result is zero, the zero flag will be set</span>

<span class="k">DEY</span>        <span class="c1">; DEcrement Y</span>
           <span class="c1">; if the result is zero, the zero flag will be set</span>

<span class="k">DEX</span>        <span class="c1">; DEcrement X</span>
           <span class="c1">; if the result is zero, the zero flag will be set</span>

<span class="k">ASL</span> <span class="n">A</span>      <span class="c1">; Arithmetic Shift Left</span>
           <span class="c1">; shift all bits one position to the left</span>
           <span class="c1">; this is a multiply by 2</span>
           <span class="c1">; if the result is zero, the zero flag will be set</span>

<span class="k">LSR</span> <span class="mh">$6000</span>  <span class="c1">; Logical Shift Right</span>
           <span class="c1">; shift all bits one position to the right</span>
           <span class="c1">; this is a divide by 2</span>
           <span class="c1">; if the result is zero, the zero flag will be set</span>
</pre></div>
</div>
</div>
<div class="section" id="common-comparison-opcodes">
<h3>3.5.3. Common Comparison opcodes<a class="headerlink" href="#common-comparison-opcodes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="k">CMP</span> <span class="p">#</span><span class="mh">$01</span>   <span class="c1">; CoMPare A to the value $01</span>
           <span class="c1">; this actually does a subtract, but does not keep the result</span>
           <span class="c1">; instead you check the status register to check for equal,</span>
           <span class="c1">; less than, or greater than</span>

<span class="k">CPX</span> <span class="mh">$0050</span>  <span class="c1">; ComPare X to the value at address $0050</span>

<span class="k">CPY</span> <span class="p">#</span><span class="mh">$FF</span>   <span class="c1">; ComPare Y to the value $FF</span>
</pre></div>
</div>
</div>
<div class="section" id="common-control-flow-opcodes">
<h3>3.5.4. Common Control Flow opcodes<a class="headerlink" href="#common-control-flow-opcodes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="k">JMP</span> <span class="mh">$8000</span>  <span class="c1">; JuMP to $8000, continue running code there</span>

<span class="k">BEQ</span> <span class="mh">$FF00</span>  <span class="c1">; Branch if EQual, contnue running code there</span>
           <span class="c1">; first you would do a CMP, which clears or sets the zero flag</span>
           <span class="c1">; then the BEQ will check the zero flag</span>
           <span class="c1">; if zero is set (values were equal) the code jumps to $FF00 and runs there</span>
           <span class="c1">; if zero is clear (values not equal) there is no jump, runs next instruction</span>

<span class="k">BNE</span> <span class="mh">$FF00</span>  <span class="c1">; Branch if Not Equal - opposite above, jump is made when zero flag is clear</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nes-code-structure">
<h2>3.6. NES Code Structure<a class="headerlink" href="#nes-code-structure" title="Permalink to this headline">¶</a></h2>
<div class="section" id="getting-started">
<h3>3.6.1. Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h3>
<p>This section has a lot of information because it will get everything set up to
run your first NES program. Much of the code can be copy/pasted then ignored
for now. The main goal is to just get NESASM to output something useful.</p>
</div>
<div class="section" id="ines-header">
<h3>3.6.2. iNES Header<a class="headerlink" href="#ines-header" title="Permalink to this headline">¶</a></h3>
<p>The 16 byte iNES header gives the emulator all the information about the game
including mapper, graphics mirroring, and PRG/CHR sizes. You can include all
this inside your asm file at the very beginning.:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="kp">.inesprg</span> <span class="mi">1</span>   <span class="c1">; 1x 16KB bank of PRG code</span>
<span class="kp">.ineschr</span> <span class="mi">1</span>   <span class="c1">; 1x 8KB bank of CHR data</span>
<span class="kp">.inesmap</span> <span class="mi">0</span>   <span class="c1">; mapper 0 = NROM, no bank swapping</span>
<span class="kp">.inesmir</span> <span class="mi">1</span>   <span class="c1">; background mirroring (ignore for now)</span>
</pre></div>
</div>
</div>
<div class="section" id="banking">
<h3>3.6.3. Banking<a class="headerlink" href="#banking" title="Permalink to this headline">¶</a></h3>
<p>NESASM arranges everything in 8KB code and 8KB graphics banks. To fill the 16KB
PRG space 2 banks are needed. Like most things in computing, the numbering
starts at 0. For each bank you have to tell the assembler where in memory it
will start.:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span>  <span class="kp">.bank</span> <span class="mi">0</span>
  <span class="kp">.org</span> <span class="mh">$C000</span>
<span class="c1">;some code here</span>

  <span class="kp">.bank</span> <span class="mi">1</span>
  <span class="kp">.org</span> <span class="mh">$E000</span>
<span class="c1">; more code here</span>

  <span class="kp">.bank</span> <span class="mi">2</span>
  <span class="kp">.org</span> <span class="mh">$0000</span>
<span class="c1">; graphics here</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-binary-files">
<h3>3.6.4. Adding Binary Files<a class="headerlink" href="#adding-binary-files" title="Permalink to this headline">¶</a></h3>
<p>Additional data files are frequently used for graphics data or level data. The
incbin directive can be used to include that data in your .NES file. This data
will not be used yet, but is needed to make the .NES file size match the iNES
header.:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="kp">.bank</span> <span class="mi">2</span>
<span class="kp">.org</span> <span class="mh">$0000</span>
<span class="kp">.incbin</span> <span class="s">&quot;mario.chr&quot;</span>   <span class="c1">;includes 8KB graphics file from SMB1</span>
</pre></div>
</div>
</div>
<div class="section" id="vectors">
<h3>3.6.5. Vectors<a class="headerlink" href="#vectors" title="Permalink to this headline">¶</a></h3>
<p>There are three times when the NES processor will interrupt your code and jump
to a new location. These vectors, held in PRG ROM tell the processor where to
go when that happens. Only the first two will be used in this tutorial.</p>
<dl class="docutils">
<dt>NMI Vector</dt>
<dd>this happens once per video frame, when enabled. The PPU tells the
processor it is starting the VBlank time and is available for graphics
updates.</dd>
<dt>RESET Vector</dt>
<dd>this happens every time the NES starts up, or the reset button is pressed.</dd>
<dt>IRQ Vector</dt>
<dd>this is triggered from some mapper chips or audio interrupts and will not
be covered.</dd>
</dl>
<p>These three must always appear in your assembly file the right order.  The .dw
directive is used to define a Data Word (1 word = 2 bytes):</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span><span class="kp">.bank</span> <span class="mi">1</span>
<span class="kp">.org</span> <span class="mh">$FFFA</span>     <span class="c1">;first of the three vectors starts here</span>
<span class="kp">.dw</span> <span class="n">NMI</span>        <span class="c1">;when an NMI happens (once per frame if enabled) the</span>
                 <span class="c1">;processor will jump to the label NMI:</span>
<span class="kp">.dw</span> <span class="n">RESET</span>      <span class="c1">;when the processor first turns on or is reset, it will jump</span>
                 <span class="c1">;to the label RESET:</span>
<span class="kp">.dw</span> <span class="mi">0</span>          <span class="c1">;external interrupt IRQ is not used in this tutorial</span>
</pre></div>
</div>
</div>
<div class="section" id="reset-code">
<h3>3.6.6. Reset Code<a class="headerlink" href="#reset-code" title="Permalink to this headline">¶</a></h3>
<p>The reset vector was set to the label RESET, so when the processor starts up it
will start from RESET: Using the .org directive that code is set to a space in
game ROM. A couple modes are set right at the beginning. We are not using IRQs,
so they are turned off. The NES 6502 processor does not have a decimal mode, so
that is also turned off. This section does NOT include everything needed to run
code on the real NES, but will work with the FCEUXD SP emulator. More reset
code will be added later.:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span>  <span class="kp">.bank</span> <span class="mi">0</span>
  <span class="kp">.org</span> <span class="mh">$C000</span>
<span class="nl">RESET:</span>
  <span class="k">SEI</span>        <span class="c1">; disable IRQs</span>
  <span class="k">CLD</span>        <span class="c1">; disable decimal mode</span>
</pre></div>
</div>
</div>
<div class="section" id="completing-the-program">
<h3>3.6.7. Completing The Program<a class="headerlink" href="#completing-the-program" title="Permalink to this headline">¶</a></h3>
<p>Your first program will be very exciting, displaying an entire screen of one
color! To do this the first PPU settings need to be written. This is done to
memory address $2001. The 76543210 is the bit number, from 7 to 0. Those 8 bits
form the byte you will write to $2001.</p>
<div class="highlight-ca65" id="ppumask"><span id="index-0"></span><div class="highlight"><pre><span></span><span class="n">PPUMASK</span> <span class="p">(</span><span class="mh">$2001</span><span class="p">)</span>

<span class="mi">76543210</span>
<span class="o">||||||||</span>
<span class="o">|||||||+-</span> <span class="n">Grayscale</span> <span class="p">(</span><span class="mi">0</span><span class="p">:</span> <span class="n">normal</span> <span class="n">color</span><span class="c1">; 1: AND all palette entries</span>
<span class="o">|||||||</span>   <span class="n">with</span> <span class="mi">0</span><span class="n">x30</span><span class="p">,</span> <span class="n">effectively</span> <span class="n">producing</span> <span class="n">a</span> <span class="n">monochrome</span> <span class="n">display</span><span class="c1">;</span>
<span class="o">|||||||</span>   <span class="n">note</span> <span class="n">that</span> <span class="n">colour</span> <span class="n">emphasis</span> <span class="n">STILL</span> <span class="n">works</span> <span class="n">when</span> <span class="n">this</span> <span class="n">is</span> <span class="n">on</span><span class="o">!</span><span class="p">)</span>
<span class="o">||||||+--</span> <span class="n">Disable</span> <span class="n">background</span> <span class="n">clipping</span> <span class="n">in</span> <span class="n">leftmost</span> <span class="mi">8</span> <span class="n">pixels</span> <span class="n">of</span> <span class="n">screen</span>
<span class="o">|||||+---</span> <span class="n">Disable</span> <span class="n">sprite</span> <span class="n">clipping</span> <span class="n">in</span> <span class="n">leftmost</span> <span class="mi">8</span> <span class="n">pixels</span> <span class="n">of</span> <span class="n">screen</span>
<span class="o">||||+----</span> <span class="n">Enable</span> <span class="n">background</span> <span class="n">rendering</span>
<span class="o">|||+-----</span> <span class="n">Enable</span> <span class="n">sprite</span> <span class="n">rendering</span>
<span class="o">||+------</span> <span class="n">Intensify</span> <span class="n">reds</span> <span class="p">(</span><span class="k">and</span> <span class="n">darken</span> <span class="n">other</span> <span class="n">colors</span><span class="p">)</span>
<span class="o">|+-------</span> <span class="n">Intensify</span> <span class="n">greens</span> <span class="p">(</span><span class="k">and</span> <span class="n">darken</span> <span class="n">other</span> <span class="n">colors</span><span class="p">)</span>
<span class="o">+--------</span> <span class="n">Intensify</span> <span class="n">blues</span> <span class="p">(</span><span class="k">and</span> <span class="n">darken</span> <span class="n">other</span> <span class="n">colors</span><span class="p">)</span>
</pre></div>
</div>
<p>So if you want to enable the sprites, you set bit 3 to 1. For this program bits
7, 6, 5 will be used to set the screen color:</p>
<div class="highlight-ca65"><div class="highlight"><pre><span></span>  <span class="k">LDA</span> <span class="mb">%10000000</span>   <span class="c1">;intensify blues</span>
  <span class="k">STA</span> <span class="mh">$2001</span>
<span class="nl">Forever:</span>
  <span class="k">JMP</span> <span class="n">Forever</span>     <span class="c1">;infinite loop</span>
</pre></div>
</div>
</div>
<div class="section" id="putting-it-all-together">
<h3>3.6.8. Putting It All Together<a class="headerlink" href="#putting-it-all-together" title="Permalink to this headline">¶</a></h3>
<p>Download and unzip the <a class="reference external" href="https://github.com/Taywee/NerdyNights-sources/archive/master.zip">master.zip</a> sample files.  This lesson is in
<strong>background</strong>. All the code above is in the background.asm file. Make sure
that file, mario.chr, and background.bat is in the same folder as
<a class="reference download internal" href="../_downloads/NESASM3.zip" download=""><code class="xref download docutils literal"><span class="pre">NESASM3</span></code></a>, then double click on background.bat.
That will run NESASM3 and should produce background.nes. Run that NES file in
<a class="reference external" href="http://www.the-interweb.com/serendipity/exit.php?url_id=627_id=90">FCEUXD SP</a> to see
your background color! Edit background.asm to change the intensity bits 7-5 to
make the background red or green.</p>
<p>You can start the Debug... from the Tools menu in <a class="reference external" href="http://www.the-interweb.com/serendipity/exit.php?url_id=627&amp;entry_id=90">FCEUXD SP</a> to
watch your code run. Hit the Step Into button, choose Reset from the NES menu,
then keep hitting Step Into to run one instruction at a time.  On the left is
the memory address, next is the hex opcode that the 6502 is actually running.
This will be between one and three bytes. After that is the code you wrote,
with the comments taken out and labels translated to addresses. The top line is
the instruction that is going to run next. So far there isn&#8217;t much code, but
the debugger will be very helpful later.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. 6502 ASM, first app</a><ul>
<li><a class="reference internal" href="#code-layout">3.1. Code Layout</a><ul>
<li><a class="reference internal" href="#directives">3.1.1. Directives</a></li>
<li><a class="reference internal" href="#labels">3.1.2. Labels</a></li>
<li><a class="reference internal" href="#opcodes">3.1.3. Opcodes</a></li>
<li><a class="reference internal" href="#operands">3.1.4. Operands</a></li>
<li><a class="reference internal" href="#comments">3.1.5. Comments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#processor-overview">3.2. 6502 Processor Overview</a></li>
<li><a class="reference internal" href="#assembly-overview">3.3. 6502 Assembly Overview</a></li>
<li><a class="reference internal" href="#registers">3.4. 6502 Registers</a><ul>
<li><a class="reference internal" href="#accumulator">3.4.1. Accumulator</a></li>
<li><a class="reference internal" href="#index-register-x">3.4.2. Index Register X</a></li>
<li><a class="reference internal" href="#index-register-y">3.4.3. Index Register Y</a></li>
<li><a class="reference internal" href="#status-register">3.4.4. Status Register</a></li>
</ul>
</li>
<li><a class="reference internal" href="#instruction-set">3.5. 6502 Instruction Set</a><ul>
<li><a class="reference internal" href="#common-load-store-opcodes">3.5.1. Common Load/Store opcodes</a></li>
<li><a class="reference internal" href="#common-math-opcodes">3.5.2. Common Math opcodes</a></li>
<li><a class="reference internal" href="#common-comparison-opcodes">3.5.3. Common Comparison opcodes</a></li>
<li><a class="reference internal" href="#common-control-flow-opcodes">3.5.4. Common Control Flow opcodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nes-code-structure">3.6. NES Code Structure</a><ul>
<li><a class="reference internal" href="#getting-started">3.6.1. Getting Started</a></li>
<li><a class="reference internal" href="#ines-header">3.6.2. iNES Header</a></li>
<li><a class="reference internal" href="#banking">3.6.3. Banking</a></li>
<li><a class="reference internal" href="#adding-binary-files">3.6.4. Adding Binary Files</a></li>
<li><a class="reference internal" href="#vectors">3.6.5. Vectors</a></li>
<li><a class="reference internal" href="#reset-code">3.6.6. Reset Code</a></li>
<li><a class="reference internal" href="#completing-the-program">3.6.7. Completing The Program</a></li>
<li><a class="reference internal" href="#putting-it-all-together">3.6.8. Putting It All Together</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="nesarchitecture.html"
                        title="previous chapter">2. NES Architecture Overview</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="colorpalettes.html"
                        title="next chapter">4. Color Palettes, Sprites, second app</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/nerdynights/asmfirstapp.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="colorpalettes.html" title="4. Color Palettes, Sprites, second app"
             >next</a> |</li>
        <li class="right" >
          <a href="nesarchitecture.html" title="2. NES Architecture Overview"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Nerdy Nights 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../nerdynights.html" >Nerdy Nights</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, bunnyboy, MetalSlime, Taywee.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>